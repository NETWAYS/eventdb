#!/bin/sh
# Start/stop the syslog2mysql daemon.

DAEMON=/usr/local/icinga/contrib/syslog-ng2mysql.pl
PID=/usr/local/icinga/var/syslog-ng2mysql.pid
#FIFO="/var/run/syslog-ng.pipe"
FIFO=$(cat $DAEMON |egrep -i '^my \$fifo' |cut -d"=" -f2 |sed 's/"//g; s/;//g')
test -p $FIFO || mkfifo $FIFO

test -f /$DAEMON || exit 0

case "$1" in
start) echo -n "Starting syslog2mysql daemon"
startproc -p $PID $DAEMON
echo "."
;;
stop) echo -n "Stoping syslog2mysql daemon"
start-stop-daemon --stop --quiet --pidfile $PID
killall syslog-ng2mysql.pl
echo "."
;;
*) echo "Usage: /etc/init.d/syslogd2mysql start|stop"
exit 1
;;
esac
exit 0

